<!DOCTYPE html>












  


<html class="theme-next muse use-motion" lang="Chinese, English, French">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
























<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=7.1.1">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.1.1">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.1.1">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.1.1">


  <link rel="mask-icon" href="/images/logo.svg?v=7.1.1" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '7.1.1',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: false,
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="This post presents a method to create custom API endpoints in WordPress REST API (V2).  WordPress REST APIThe WordPress REST API provides API endpoints for WordPress data types that allow developers t">
<meta name="keywords" content="WordPress,php,api">
<meta property="og:type" content="article">
<meta property="og:title" content="Add a custom API in WordPress">
<meta property="og:url" content="http://pepper-targaryen.github.io/2018/08/08/Add-Custom-Api-WP/index.html">
<meta property="og:site_name" content="Dream Big">
<meta property="og:description" content="This post presents a method to create custom API endpoints in WordPress REST API (V2).  WordPress REST APIThe WordPress REST API provides API endpoints for WordPress data types that allow developers t">
<meta property="og:locale" content="Chinese, English, French">
<meta property="og:updated_time" content="2019-05-30T23:45:48.608Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Add a custom API in WordPress">
<meta name="twitter:description" content="This post presents a method to create custom API endpoints in WordPress REST API (V2).  WordPress REST APIThe WordPress REST API provides API endpoints for WordPress data types that allow developers t">





  
  
  <link rel="canonical" href="http://pepper-targaryen.github.io/2018/08/08/Add-Custom-Api-WP/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Add a custom API in WordPress | Dream Big</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="Chinese, English, French">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Dream Big</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>Home</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>Archives</a>

  </li>

      
      
    </ul>
  

  
    

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://pepper-targaryen.github.io/2018/08/08/Add-Custom-Api-WP/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Pepper Targaryen">
      <meta itemprop="description" content="This is a blog of Pepper Targaryen.">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dream Big">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Add a custom API in WordPress

              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-08-08 00:00:00" itemprop="dateCreated datePublished" datetime="2018-08-08T00:00:00+02:00">2018-08-08</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-05-31 01:45:48" itemprop="dateModified" datetime="2019-05-31T01:45:48+02:00">2019-05-31</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>This post presents a method to create custom API endpoints in WordPress REST API (V2). </p>
<h2 id="WordPress-REST-API"><a href="#WordPress-REST-API" class="headerlink" title="WordPress REST API"></a>WordPress REST API</h2><p>The <a href="https://wordpress.org/plugins/rest-api/" target="_blank" rel="noopener">WordPress REST API</a> provides API endpoints for WordPress data types that allow developers to interact with sites remotely by sending and receiving JSON (JavaScript Object Notation) objects. When you send content to or make a request to the API, the response will be returned in JSON. This enables developers to create, read and update WordPress content from client-side JavaScript or from external applications, even those written in languages beyond PHP. There are several default key words like <code>posts</code>, <code>users</code>, <code>comments</code> and so on. To use one of these key words, we would just for example make a <code>GET</code> request to <code>https://example.com/wp-json/wp/v2/posts</code>. We would get a JSON response showing us all the posts of our website.</p>
<h2 id="Adding-Custom-Endpoints"><a href="#Adding-Custom-Endpoints" class="headerlink" title="Adding Custom Endpoints"></a>Adding Custom Endpoints</h2><p>The WordPress REST API is more than just a set of default routes. It is also a tool for creating custom routes and endpoints.</p>
<p>Though <a href="https://v2.wp-api.org/extending/adding/" target="_blank" rel="noopener">the official document</a> is very detailed, I still have some problems understanding the basic usage because I’m not so familiar with the <code>PHP</code> language and some concepts are abstract. On one hand, I didn’t know where to insert this part of code, while on the other hand, I didn’t what kind of code works to satisfy my needs. I didn’t fully understand how to add a custom endpoint until I finally found <a href="https://www.tychesoftwares.com/creating-custom-api-endpoints-in-the-wordpress-rest-api/" target="_blank" rel="noopener">the blog of <em>Pinal Shah</em></a>, demonstrating several examples with full explanations. When I look back to the official document after having tried several examples of <em>Pinal Shah</em>, I start to understand what the official document really want to express. Still I have to say the official document is very detailed and it contains almost everything. If you don’t understand it at the first time just like me, don’t worry. Some examples can help you better understand.</p>
<h2 id="Example-API-for-mobile-applications"><a href="#Example-API-for-mobile-applications" class="headerlink" title="Example - API for mobile applications"></a>Example - API for mobile applications</h2><p>What I want to do is quite simple. I hava a website on WordPress including a tool for OCR (Optical Charactor Recognization). A client could upload an image or a document like <code>pdf</code>, and then he would get the recognized text from the image. Instead of sending back the raw text from the detection, the tool would apply <code>Regex</code> to extract useful information. Let’s say if a client could upload a electricity bill, the tool could help the client find his subscribing price, services fees… </p>
<p>Anyway, our mobile applications also want to integrate this tool, but we kind of don’t want to write this tool for another version of <code>Android</code> and <code>IOS</code>. It seems that writing a custom API could be the best solution and if we want to add new features to the tool, we would only have to modify the tool on the website.</p>
<h3 id="Creating-a-Custom-Endpoint"><a href="#Creating-a-Custom-Endpoint" class="headerlink" title="Creating a Custom Endpoint"></a>Creating a Custom Endpoint</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  add_action( <span class="string">'rest_api_init'</span>, <span class="string">'my_register_route'</span> );</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">my_register_route</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    register_rest_route( <span class="string">'my-route'</span>, <span class="string">'pepper/(?P&lt;type&gt;[^/]+)/(?P&lt;id&gt;[\d]+)/(?P&lt;ext&gt;[^/]+)'</span>, <span class="keyword">array</span>(</span><br><span class="line">            <span class="string">'methods'</span> =&gt; <span class="string">'GET'</span>,</span><br><span class="line">            <span class="string">'callback'</span> =&gt; <span class="string">'custom_phrase'</span>,</span><br><span class="line">            <span class="string">'args'</span> =&gt; <span class="keyword">array</span>(</span><br><span class="line">              <span class="string">'type'</span> =&gt; <span class="keyword">array</span>( </span><br><span class="line">                <span class="string">'validate_callback'</span> =&gt; <span class="function"><span class="keyword">function</span><span class="params">( $param, $request, $key )</span> </span>&#123;</span><br><span class="line">                  <span class="keyword">return</span> is_string( $param );</span><br><span class="line">                &#125;</span><br><span class="line">              ),</span><br><span class="line">              <span class="string">'id'</span> =&gt; <span class="keyword">array</span>( </span><br><span class="line">                <span class="string">'validate_callback'</span> =&gt; <span class="function"><span class="keyword">function</span><span class="params">( $param, $request, $key )</span> </span>&#123;</span><br><span class="line">                  <span class="keyword">return</span> is_numeric( $param );</span><br><span class="line">                &#125;</span><br><span class="line">              ),</span><br><span class="line">              <span class="string">'ext'</span> =&gt; <span class="keyword">array</span>( </span><br><span class="line">                <span class="string">'validate_callback'</span> =&gt; <span class="function"><span class="keyword">function</span><span class="params">( $param, $request, $key )</span> </span>&#123;</span><br><span class="line">                  <span class="keyword">return</span> is_string( $param );</span><br><span class="line">                &#125;</span><br><span class="line">              ),</span><br><span class="line">            ),</span><br><span class="line">          )</span><br><span class="line">        );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">custom_phrase</span><span class="params">($data)</span> </span>&#123;</span><br><span class="line">    $results = <span class="keyword">array</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The part of text detection. </span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> rest_ensure_response( $results );</span><br><span class="line">  &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>register_rest_route</code> is the function that we need to use to register a new route with WordPress. This function needs to be added in a function attached to the <code>rest_api_init</code> hook.</p>
<p>The first argument in the <code>register_rest_route</code> function is the <strong>namespace</strong>. This namespace helps us to group together all our routes.</p>
<p>It is extremely important to add namespaces to your routes. The “core” endpoints use the <code>wp/v2</code> namespace. The first part of the namespace is <code>wp</code>, which represents the vendor name; <code>WordPress</code> and <code>v2</code> is the version number. In my example, I used <code>my-route</code> as <strong>namespace</strong>.</p>
<p>The second argument is the <strong>resource path</strong>. The resource path signifies what resource the endpoint is associated with (like posts, comments and so on). In our case, we will name it <code>pepper</code>.</p>
<p>The <code>&#39;/(?P&lt;type&gt;[^/]+)/(?P&lt;id&gt;[\d]+)/(?P&lt;ext&gt;[^/]+)&#39;</code> after <code>&#39;pepper&#39;</code> indicates three parameters passed by the url. </p>
<blockquote>
<p><code>&#39;?P&#39;</code> means here goes a parameter. <code>&#39;&lt;type&gt;&#39;</code> means this parameter is named as <em>type</em>. And <code>&#39;[^/]+&#39;</code> is the regular expression searching for any string containing no <code>&#39;/&#39;</code>. <code>&#39;[\d]+&#39;</code> means a string of numbers.</p>
</blockquote>
<p>The third argument is an array of options. Here we specify what methods the endpoint can use and callback functions for each method. This argument also allows us to provide a permissions callback, which can restrict access for the endpoint to certain users.</p>
<blockquote>
<p><code>&#39;validate_callback&#39;</code> is used to pass a function that will be passed the value of the argument. That function should return true if the value is valid, and false if not.</p>
</blockquote>
<blockquote>
<p><code>&#39;sanitize_callback&#39;</code> is used to pass a function that is used to sanitize the value of the argument before passing it to the main callback.</p>
</blockquote>
<p>Using <code>sanitize_callback</code> and <code>validate_callback</code> allows the main callback to act only to process the request, and prepare data to be returned using the <code>WP_REST_Response</code> class. By using these two callbacks, you will be able to safely assume your inputs are valid and safe when processing.</p>
<p>Once this endpoint is created, you can access it at the below url <code>https://mysite.com/wp-json/my-route/pepper/images/1/jpeg</code></p>
<p>The function <code>custom_phrase</code> will return the response to the client. We could have access to the passed parameters by calling <code>$data[&#39;type&#39;]</code>.</p>
<p>In this example, I’ve defined 3 parameters. <code>type</code> indicates wether it’s <code>pdf</code> or <code>images</code>. <code>id</code> indicates the name of the file. And <code>ext</code> indicates the extension of the file.</p>
<h3 id="Use-the-Custom-Endpoint"><a href="#Use-the-Custom-Endpoint" class="headerlink" title="Use the Custom Endpoint"></a>Use the Custom Endpoint</h3><p>On the mobile phone, there’s nothing difficult to use the tool of the website.</p>
<ol>
<li>Find the desired image, whether it’s in the gallery or just take one with the camera.</li>
<li>Upload the image to the server.</li>
<li>Make a <code>Request</code> to the custom endpoint by the url <code>https://mysite.com/wp-json/my-route/pepper/images/&lt;id&gt;/&lt;ext&gt;</code></li>
</ol>

      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/WordPress/" rel="tag"># WordPress</a>
          
            <a href="/tags/php/" rel="tag"># php</a>
          
            <a href="/tags/api/" rel="tag"># api</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/08/02/summer-intern/" rel="next" title="In the middle of my summer intern in France">
                <i class="fa fa-chevron-left"></i> In the middle of my summer intern in France
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/05/31/Stop-Wearing-Others-Shirts/" rel="prev" title="Stop Wearing Others' Shirts">
                Stop Wearing Others' Shirts <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Pepper Targaryen</p>
              <div class="site-description motion-element" itemprop="description">This is a blog of Pepper Targaryen.</div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">3</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">8</span>
                    <span class="site-state-item-name">tags</span>
                  
                </div>
              
            </nav>
          

          

          

          

          

          
          

          
            
          
          

        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#WordPress-REST-API"><span class="nav-number">1.</span> <span class="nav-text">WordPress REST API</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Adding-Custom-Endpoints"><span class="nav-number">2.</span> <span class="nav-text">Adding Custom Endpoints</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Example-API-for-mobile-applications"><span class="nav-number">3.</span> <span class="nav-text">Example - API for mobile applications</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Creating-a-Custom-Endpoint"><span class="nav-number">3.1.</span> <span class="nav-text">Creating a Custom Endpoint</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Use-the-Custom-Endpoint"><span class="nav-number">3.2.</span> <span class="nav-text">Use the Custom Endpoint</span></a></li></ol></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Pepper Targaryen</span>

  

  
</div>


  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.8.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v7.1.1</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/utils.js?v=7.1.1"></script>

  <script src="/js/motion.js?v=7.1.1"></script>



  
  


  <script src="/js/schemes/muse.js?v=7.1.1"></script>



  
  <script src="/js/scrollspy.js?v=7.1.1"></script>
<script src="/js/post-details.js?v=7.1.1"></script>



  


  <script src="/js/next-boot.js?v=7.1.1"></script>


  

  

  

  


  


  




  

  

  

  

  

  

  

  

  

  

  

  

  

  

</body>
</html>
